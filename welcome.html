<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bienvenido • HelpDeskCloud</title>
    <link rel="stylesheet" href="assets/styles.css?v=3" />
  </head>
  <body>
    <main class="container">
      <h1>Bienvenido</h1>
      <p id="userInfo">Cargando usuario...</p>
      <div class="actions">
        <a href="#" class="link link-back">Volver</a>
      </div>
    </main>

    <script src="js/config.js"></script>
    <script src="js/common.js"></script>
    <script>
      (async function() {
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = 'index.html';
          return;
        }
        try {
          const res = await fetch(`${BACKEND_URL}/auth/me`, {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          if (res.ok) {
            const me = await res.json();
            const email = me && (me.email || me.username || me.user || me.name);
            document.getElementById('userInfo').textContent = email ? `Hola, ${email}` : 'Sesión válida.';
          } else {
            const fallbackEmail = localStorage.getItem('user_email');
            document.getElementById('userInfo').textContent = fallbackEmail ? `Hola, ${fallbackEmail}` : 'Sesión inválida. Inicia de nuevo.';
          }
        } catch (e) {
          const fallbackEmail = localStorage.getItem('user_email');
          document.getElementById('userInfo').textContent = fallbackEmail ? `Hola, ${fallbackEmail}` : 'Error de red. Verifica la API URL.';
        }
        // Logout se gestiona desde el menú de perfil en common.js
      })();
    </script>
  </body>
  </html>